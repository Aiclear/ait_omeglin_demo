<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Omeglin - Talk to strangers</title>
  <link href="/favicon.ico" type="image/svg+xml" rel="icon">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
<header>
  <div class="header-container">
    <img src="/omeglin.svg" alt="Omeglin logo" class="logo">
    <div class="user-info">
      <button id="username"></button>
      <button id="logout">注销</button>
    </div>
  </div>
</header>
<main>
  <div class="video-panel">
    <section class="remote">
      <img src="/tail-spin.svg" class="spinner" alt="">
      <video id="remoteVideo" autoplay playsinline></video>
    </section>
    <section class="local">
      <video id="localVideo" autoplay playsinline muted></video>
    </section>
  </div>
  <div class="chat-panel">
    <div class="chat-log" id="chatLog"></div>
    <div class="chat-controls">
      <div class="pairing">
        <button id="startPairing">Find stranger</button>
        <button id="abortPairing">Cancel</button>
        <button id="leavePairing">Disconnect</button>
      </div>
      <div class="messaging">
        <label for="chatInput">
          <input type="text" placeholder="Type a message..." id="chatInput">
        </label>
        <button id="chatSend">Send</button>
      </div>
    </div>
  </div>
</main>
<script type="module" src="/js/app.js"></script>
<script type="module">
  import {post, isOk} from '/js/util.js';

  document.getElementById("logout")
      .addEventListener("click", async () => {
        let res = await post('/api/auth/logout');
        if (isOk(res)) {
          localStorage.clear()
          window.location.href = "/login.html";
        } else {
          window.alert(res.message);
        }
      });
</script>
<script>
  // 查询登录用户的信息
  document.addEventListener('DOMContentLoaded', async () => {
    let user = JSON.parse(localStorage.getItem("user"));
    if (user) {
      document.getElementById("username").innerText = user.username;
    }
  });
</script>
</body>
</html>
